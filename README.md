# Ebicon 6th 抽選アプリケーション

## 概要
[Ebicon 6th](http://ebicon.tennana.net/ebicon06/)で使い捨てた、卓分け用のWEBアプリケーションです。

予めtableInformation.jsに定義された卓(table)に対して、GoogleまたはTwitter認証したユーザーごとに名前と第一希望・第二希望を登録してもらい、管理画面上で抽選します。ユーザーは抽選結果について、同じ画面上で確認することができます。

イベント当日はスマートフォンでの参照が前提になるので、モバイルファーストなデザインをしています。(持ってない人には管理画面で手動登録できるようにしていましたが使いませんでした。現代だね。)

## 経緯
Ebicon 6thは今までと違って、集合したあとに会場への移動を挟む上、終了時間が普段より早いため、卓抽選時間を取ると肝心の遊ぶ時間が削られる恐れがあった。  
ただでさえEbiconの抽選方式は時間が伸びがちになる上、事前抽選して当日に欠席されると調整がとても面倒なので文明の利器に頼ることにした。
が、着想は早かったのに3日前まで放置したおかげで手抜きを追及する事態に陥ったのであった。開発は計画的に。

## バックエンドについて
書き込み失敗とかテーブル定義とかに時間使いたくなかったのでGoogleのFirebaseに丸投げ。同期型DBである必要はそんなになかった。

## フロントエンドについて
バックエンドがFirebaseの時点でPHP他は要らないので使ったことのあるMVCフレームワークとしてRiot.jsを選択。
さりげなくまともに使ったことがなかった、CSSフレームワークの選定の方が時間がかかっている。

Firebaseから値の更新通知があったら渡してupdateするだけで、細かくDOM操作しなくて済んだのはとても楽。

## 抽選ロジックについて
なるべく5thまでホワイトボードでやっていた方法に動きが近くなるように。どうしても立卓しなかったり、人数が足りない卓が複数出たりする可能性があったので、
抽選即時確定ではなく、管理者が画面上での最終確認と、必要があれば割り当てを変更して最終決定する構造になっています。

## その他ひっかかったこと
* www.gstatic.comの応答速度がfirebaseのホスティングより遅かったので実際は一緒にホストしていた。
* 名前の登録がないうちから事前公開したので、登録時期によっては各データの区別をつけるのが困難だった。気づいてなかった。
* 本番になって卓を確定したら他の情報が吹き飛ぶ検証不足を露呈。loggerを取っていなければ誰がどの卓を希望していたか分からなかったことだろう。
* 開発中にTwitter認証が動かなくなって焦り、時間を浪費する(Twitter側の問題だったみたい)
* Wi-Fiルータ利用のAndroidタブレットで管理画面がフリーズ。

## ライセンス
[Stanko/skyblue](Stanko/skyblue)
[css/*](css/) , [fonts/*](fonts/)

WTFPL (Do What The Fuck You Want To Public License).
[index.html](index.html) [tableInfo.tag](tableInfo.tag)
[adminEbi.html](adminEbi.html) [tableadmin.tag](tableadmin.tag) Except "function randAry2".
